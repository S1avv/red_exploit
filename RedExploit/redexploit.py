from __init__ import *


def print_title():

    os.system('cls' if os.name == 'nt' else 'clear')

    tprint(APP_TITLE)

    match States.os:
        case None:
            print("▷ Select operating system: \n1. Windows\n2. Linux")

            while True:
                try:
                    answer = int(input(""))

                    if answer == 1:
                        answer = "Windows"
                        States.os = "Windows"
                        break
                    elif answer == 2:
                        answer = "Linux"
                        States.os = "Linux"
                        break
                    else:
                        raise
                except:
                    print_title()
    
                finally:
                    print_title()


    match States.port:
        case None:
            print("▷ Enter Enter local open port: ")
            
            while True:
                try:
                    answer = int(input(""))

                    if answer > 65535 or answer < 0:
                        raise

                    States.port = answer

                except:
                    print_title()
    
                finally:
                    print_title()

    match States.app_name:
        case None:
            print("▷ Enter application name: ")
            
            while True:
                try:
                    answer = input("")

                    if len(answer) > 255:
                        raise

                    if answer == "":
                        answer = "app"

                    States.app_name = answer
                except:
                    print_title()
    
                finally:
                    print_title()

    match States.server_addr:
        case None:
            print("▷ Enter the server address (example: 1.tcp.eu.ngrok.io:12841): ")
            
            while True:
                try:
                    answer = input("")

                    if len(answer) > 100:
                        raise

                    States.server_addr = answer
                except:
                    print_title()
    
                finally:
                    print_title()

    with IncrementalBar('▷ Initializing...', max=60450) as bar:
        for i in range(60450):
            bar.next()

    print("\n")

    with IncrementalBar('▷ Compilation...', max=500350) as bar:
        for i in range(500350):
            bar.next()

    build_go(port=States.port, app_name=States.app_name, server_addr=States.server_addr, folder_path=States.path)

    print("\n")

    with IncrementalBar('▷ Completing setup...', max=90500) as bar:
        for i in range(90500):
            bar.next()

    print("\nSuccessfully!")

    sys.exit(0)

def main():
    print(TERMS + "\n\nDo you accept the user agreement? [yes/no]")

    answer = input().strip().lower()

    if not any(word in answer for word in ["yes", "y", "+"]):
        sys.exit()

    print_title()
